<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>SinFiltro — Premium (Móvil)</title>
  <meta name="description" content="SinFiltro — feed visual premium. Móvil optimizado: scroll global, horizontales drag, viewer, menú lateral, FAB burbujas, buscador con miniaturas." />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    /* ================= VARS ================= */
    :root{
      --bg-1:#05060a; --bg-2:#071226;
      --accent-cyan:#00d1ff; --accent-violet:#8a6eff;
      --muted:#9fb0bf; --card:rgba(255,255,255,0.03);
      --glass: rgba(255,255,255,0.04);
      --radius:14px; --trans:260ms;
      --text:#eaf7ff;
      --skel-color: rgba(255,255,255,0.05);
    }
    html,body{height:100%;margin:0;padding:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;background:linear-gradient(180deg,var(--bg-1),var(--bg-2));color:var(--text);-webkit-font-smoothing:antialiased; -webkit-overflow-scrolling:touch;}
    body.light{ --bg-1:#f5f9ff; --bg-2:#eef6ff; --accent-cyan:#0066cc; --accent-violet:#5e3bff; --muted:#516070; --text:#071226; --skel-color: rgba(0,0,0,0.05); background:linear-gradient(180deg,var(--bg-1),var(--bg-2)); color:var(--text); }

    .bg-anim{position:fixed;inset:0;z-index:-10;pointer-events:none;background:
      radial-gradient(600px 320px at 10% 10%, rgba(138,110,255,0.06), transparent 8%),
      radial-gradient(900px 420px at 90% 80%, rgba(0,209,255,0.04), transparent 10%);filter:blur(28px) saturate(1.05);animation: drift 20s linear infinite}
    @keyframes drift{0%{transform:translate3d(0,0,0)}50%{transform:translate3d(6%,-4%,0)}100%{transform:translate3d(0,0,0)}}

    /* Header */
    header{position:fixed;top:0;left:0;right:0;height:66px;display:flex;align-items:center;justify-content:center;padding:10px;z-index:120;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.005));backdrop-filter:blur(8px);border-bottom:1px solid rgba(255,255,255,0.02)}
    .header-inner{width:100%;max-width:720px;display:flex;align-items:center;justify-content:space-between;padding:0 12px;gap:10px}
    .left-ctrl{display:flex;align-items:center;gap:12px}
    .icon-btn{width:44px;height:44px;border-radius:10px;background:var(--card);display:inline-flex;align-items:center;justify-content:center;color:var(--muted);border:1px solid rgba(255,255,255,0.02);cursor:pointer;transition:transform var(--trans)}
    .icon-btn:active{transform:scale(.96)}
    .logo{font-family:'Poppins',sans-serif;font-weight:700;font-size:20px;letter-spacing:0.6px;background:linear-gradient(90deg,var(--accent-cyan),var(--accent-violet));-webkit-background-clip:text;background-clip:text;color:transparent;display:inline-block}
    .logo-btn{background:transparent;border:none;cursor:pointer;padding:6px 10px}

    /* Main */
    main{padding-top:86px;padding-bottom:120px;max-width:720px;margin:0 auto}
    .container{padding:12px}

    /* Hero */
    .hero{margin-top:4px;padding:14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.003));border:1px solid rgba(255,255,255,0.02);box-shadow:0 8px 30px rgba(0,0,0,0.45)}
    .hero h1{margin:0;font-size:16px;color:var(--accent-violet);font-weight:700}
    .hero p{margin:6px 0 0;color:var(--muted);font-size:13px}

    /* Section */
    .section{margin-top:16px}
    .section .head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .section .title{font-weight:800;color:var(--accent-cyan);font-size:18px}
    .see-all{font-size:13px;color:var(--muted);cursor:pointer}

    /* Horizontal scrollers */
    .h-stack{display:flex;flex-direction:column;gap:10px}
    .h-row{display:flex;gap:12px;overflow-x:auto;padding-bottom:6px;scroll-snap-type:x mandatory;-webkit-overflow-scrolling:touch;touch-action:pan-y}
    .h-row::-webkit-scrollbar{display:none}
    .card-small{min-width:190px;flex:0 0 190px;height:130px;border-radius:12px;overflow:hidden;position:relative;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);box-shadow:0 18px 50px rgba(2,10,18,0.6);display:flex;align-items:flex-end;padding:10px;color:#fff;scroll-snap-align:center;cursor:pointer}
    .card-small img,.card-small video{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:brightness(.56);transition:transform .9s}
    .card-small .meta{position:relative;z-index:6}
    .mini-stats{display:flex;gap:8px;align-items:center;font-size:12px;color:rgba(255,255,255,0.95)}
    .mini-badge{position:absolute;left:10px;top:10px;padding:6px 8px;border-radius:999px;background:linear-gradient(90deg,var(--accent-cyan),var(--accent-violet));color:#001;font-weight:700;font-size:12px;box-shadow:0 10px 30px rgba(0,0,0,0.35);z-index:6}
    .play-ico{width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.06);backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,0.04);cursor:pointer;box-shadow:0 8px 20px rgba(0,0,0,0.45)}

    /* Grid */
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:12px}
    .grid .card{border-radius:12px;overflow:hidden;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));border:1px solid rgba(255,255,255,0.02);box-shadow:0 12px 40px rgba(2,10,18,0.6);cursor:pointer}
    .grid img,.grid video{width:100%;height:150px;object-fit:cover}
    .grid .body{padding:8px;color:var(--text)}
    .grid .title{font-weight:700}
    .grid .meta{font-size:12px;color:var(--muted);margin-top:6px;display:flex;justify-content:space-between;align-items:center}

    /* FAB */
    .fab{position:fixed;left:50%;transform:translateX(-50%);bottom:52px;width:72px;height:72px;border-radius:50%;background:linear-gradient(135deg,var(--accent-cyan),var(--accent-violet));display:flex;align-items:center;justify-content:center;color:#001;font-size:30px;z-index:190;box-shadow:0 30px 90px rgba(0,0,0,0.6);border:none}
    .radials{position:fixed;left:50%;transform:translateX(-50%);bottom:100px;display:flex;flex-direction:column;gap:8px;align-items:flex-start;z-index:189;pointer-events:none;opacity:0;transition:opacity .18s, transform .2s;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.008));backdrop-filter:blur(8px);padding: 10px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.03);width: 200px;transform: translateX(-50%) translateY(20px);}
    .radials.show{opacity:1;pointer-events:auto; transform: translateX(-50%) translateY(0); }
    .bubble-group { display: flex; flex-direction: row; align-items: center; justify-content: flex-start; gap: 10px; padding: 10px 14px; width: 100%; background: var(--card); border-radius: 12px; border: 1px solid rgba(255,255,255,0.03); box-shadow: 0 8px 20px rgba(0,0,0,0.4); transition: background var(--trans); cursor: pointer; }
    .bubble-group:hover { background: rgba(255,255,255,0.06); }
    .bubble { width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center; background: linear-gradient(90deg,var(--accent-cyan),var(--accent-violet)); color: #000; font-weight: 700; font-size: 18px; }
    .bubble-text { font-size: 15px; font-weight: 500; color: var(--text); flex-grow: 1; text-align: left; }

    /* Bottom nav */
    .bottom-nav{position:fixed;left:10px;right:10px;bottom:10px;height:74px;border-radius:16px;background:linear-gradient(180deg, rgba(0,0,0,0.5), rgba(0,0,0,0.35));display:flex;align-items:center;justify-content:space-around;padding:0 8px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 30px 80px rgba(0,0,0,0.6);z-index:185}
    .nav-item{display:flex;flex-direction:column;align-items:center;gap:6px;color:var(--muted);font-size:12px;cursor:pointer}

    /* Panel */
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,0.45);z-index:170;display:none;pointer-events:none;transition:opacity .18s}
    .overlay.show{display:block;pointer-events:auto;opacity:1}
    .panel{position:fixed;left:0;top:0;bottom:0;height:100%;width:86%;max-width:320px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.008));backdrop-filter:blur(12px);border-radius:0 12px 12px 0;padding:12px;z-index:180;box-shadow:20px 0 80px rgba(2,10,18,0.6);transform:translateX(-100%);opacity:1;transition:transform var(--trans) ease;pointer-events:none;display:flex;flex-direction:column;overflow-y:hidden;}
    .panel.open{transform:translateX(0);pointer-events:auto}
    .panel .close{margin-left:auto;padding:6px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.03);cursor:pointer}
    .panel nav { flex-grow: 1; overflow-y: auto; padding-right: 5px; }

    /* Viewer */
    .viewer{position:fixed;inset:0;background:linear-gradient(180deg, rgba(0,0,0,0.9), rgba(0,0,0,0.95));z-index:220;display:none;align-items:center;justify-content:center;padding:10px}
    .viewer.show{display:flex}
    .viewer .card{width:100%;max-width:920px;border-radius:12px;overflow:hidden;background:#000;padding:0;box-shadow:0 30px 80px rgba(0,0,0,0.8);position:relative;}
    .viewer img,.viewer video{width:100%;height:auto;display:block;max-height:75vh;object-fit:contain;margin:0 auto;}
    .viewer-controls-meta { z-index:10;display:flex;gap:8px;justify-content:center;background:rgba(0,0,0,0.25);backdrop-filter:blur(4px);padding:8px;border-radius:12px;margin:12px auto;width:fit-content; }

    /* Modals */
    .modal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);width:92%;max-width:680px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));backdrop-filter:blur(12px);border-radius:12px;padding:12px;z-index:210;box-shadow:0 30px 80px rgba(2,10,18,0.6);display:none}
    .modal.show{display:block}
    .modal .head{display:flex;align-items:center;gap:8px;margin-bottom:8px}
    .modal .grid-mini{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;max-height:60vh;overflow:auto;padding:6px}
    .mini-thumb{border-radius:10px;overflow:hidden;background:rgba(0,0,0,0.25);height:84px;display:flex;align-items:center;justify-content:center;cursor:pointer}
    .mini-thumb img,.mini-thumb video{width:100%;height:100%;object-fit:cover}
    .search-input{flex:1;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--text)}

    /* Upload Modal */
    #uploadModal{display:none;text-align:center;padding:20px;max-width:300px;position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:var(--card);border-radius:12px;z-index:250;box-shadow:0 10px 40px rgba(0,0,0,0.7);}
    .progress-bar{width:100%;height:8px;background:rgba(255,255,255,0.1);border-radius:4px;overflow:hidden;margin-top:15px;}
    .progress-fill{height:100%;width:0;background:linear-gradient(90deg,var(--accent-cyan),var(--accent-violet));transition:width 0.3s linear;}

    /* File Select */
    #fileSelectModal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:240;display:none;align-items:flex-end;justify-content:center;opacity:0;transition:opacity 0.3s ease-out;}
    #fileSelectModal.show{opacity:1;display:flex;}
    #fileSelectModal > div{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));backdrop-filter:blur(12px);border-radius:12px 12px 0 0;padding:20px;width:100%;max-width:450px;transform:translateY(100%);transition:transform 0.3s ease-out;}
    #fileSelectModal.show > div{transform:translateY(0);}

    /* Iconos SVG */
    Heart,Fire,Play,Plus,Search,Moon,Home,Eye,User,Menu,Close,Download,Left,Right{display:inline-block;width:1.2em;height:1.2em;background:currentColor;mask-size:contain;mask-repeat:no-repeat;mask-position:center;-webkit-mask-size:contain;-webkit-mask-repeat:no-repeat;-webkit-mask-position:center;}
    Heart{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");}
    Fire{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M13.5 2c-5.288 0-9.649 3.914-9.999 8.977 0 3.659 2.137 6.817 5.234 8.433.308.162.538.492.604.888.066.396-.048.776-.288.997-.24.22-.56.275-.854.143-.294-.132-.607-.37-.86-.672-.503-.605-.792-1.334-.792-2.109 0-1.475.963-2.722 2.297-3.193.054-.019.11-.03.167-.03 1.076 0 1.95.874 1.95 1.95 0 .884-.588 1.63-1.39 1.87-.103.03-.169.123-.169.228v2.456c0 .104.084.188.188.188h6.375c.104 0 .188-.084.188-.188v-2.456c0-.105-.066-.198-.169-.228-.802-.24-1.39-.986-1.39-1.87 0-1.076.874-1.95 1.95-1.95.057 0 .113.011.167.03 1.334.471 2.297 1.718 2.297 3.193 0 .775-.289 1.504-.792 2.109-.253.302-.566.54-.86.672-.294.132-.614.077-.854-.143-.24-.221-.354-.601-.288-.997.066-.396.296-.726.604-.888 3.097-1.616 5.234-4.774 5.234-8.433C22.149 5.914 18.788 2 13.5 2z'/%3E%3C/svg%3E");}
    Play{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M8 5v14l11-7z'/%3E%3C/svg%3E");}
    Plus{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z'/%3E%3C/svg%3E");}
    Search{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z'/%3E%3C/svg%3E");}
    Moon{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M9.37 5.51A7.35 7.35 0 009.1 7.5c0 4.08 3.32 7.4 7.4 7.4.68 0 1.35-.09 1.99-.27A7.014 7.014 0 0112 19c-3.86 0-7-3.14-7-7 0-2.93 1.81-5.45 4.37-6.49z'/%3E%3C/svg%3E");}
    Home{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z'/%3E%3C/svg%3E");}
    Eye{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z'/%3E%3C/svg%3E");}
    User{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/%3E%3C/svg%3E");}
    Menu{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z'/%3E%3C/svg%3E");}
    Close{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z'/%3E%3C/svg%3E");}
    Download{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z'/%3E%3C/svg%3E");}
    Left{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z'/%3E%3C/svg%3E");}
    Right{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z'/%3E%3C/svg%3E");}

    @media (max-width:420px){.card-small{min-width:150px;height:100px}.grid img,.grid video{height:120px}.fab{width:64px;height:64px}.panel{width:92%}}
    @supports not ((-webkit-backdrop-filter: blur(1px)) or (backdrop-filter: blur(1px))) {.panel, header, .modal { background: linear-gradient(180deg, rgba(0,0,0,0.65), rgba(0,0,0,0.45)); }}
    .fade-up{animation:fadeUp .48s cubic-bezier(.2,.9,.2,1) both}
    @keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
  </style>
</head>
<body>
  <div class="bg-anim" aria-hidden="true"></div>

  <header>
    <div class="header-inner">
      <div class="left-ctrl">
        <button id="menuBtn" class="icon-btn" aria-label="abrir menú">Menu</button>
        <button class="logo-btn" id="brandBtn"><span class="logo">SinFiltro</span></button>
      </div>
      <div style="display:flex;align-items:center;gap:8px">
        <button id="searchTop" class="icon-btn" title="Buscar">Search</button>
        <button id="themeToggle" class="icon-btn" title="Modo">Moon</button>
      </div>
    </div>
  </header>

  <div id="overlay" class="overlay" aria-hidden="true"></div>
  <aside id="panel" class="panel" aria-hidden="true" role="dialog" aria-label="Menú lateral">
    <div style="display:flex;align-items:center;gap:8px">
      <strong>Cuenta</strong>
      <button id="closePanel" class="panel-close panel-action icon-btn" style="margin-left:auto" title="Cerrar">Close</button>
    </div>
    <p style="margin:8px 0 12px 0;color:var(--muted)">Ajustes, demo y tu contenido.</p>
    <nav style="display:flex;flex-direction:column;gap:8px">
      <button class="icon-btn panel-item" data-action="home" style="width:100%;padding:10px;border-radius:12px;justify-content:flex-start">Home Inicio</button>
      <button class="icon-btn panel-item" data-action="trends" style="width:100%;padding:10px;border-radius:12px;justify-content:flex-start">Fire Tendencias</button>
      <button class="icon-btn panel-item" data-action="reco" style="width:100%;padding:10px;border-radius:12px;justify-content:flex-start">Target Recomendados</button>
      <button class="icon-btn panel-item" data-action="my" style="width:100%;padding:10px;border-radius:12px;justify-content:flex-start">User Mi cuenta</button>
      <button class="icon-btn panel-item" data-action="settings" style="width:100%;padding:10px;border-radius:12px;justify-content:flex-start">Settings Ajustes</button>
      <button class="icon-btn panel-item" data-action="logout" style="width:100%;padding:10px;border-radius:12px;justify-content:flex-start">Exit Cerrar sesión</button>
    </nav>
  </aside>

  <main>
    <div class="container">
      <section class="hero fade-up" aria-label="presentación">
        <h1>Descubre lo auténtico</h1>
        <p>Fotos y videos creados por la comunidad. Da like, comenta y comparte.</p>
      </section>

      <section class="section fade-up" aria-label="tendencias">
        <div class="head"><div class="title">Fire Tendencias</div><div class="see-all" id="seeT">Ver todo</div></div>
        <div class="h-stack">
          <div id="trendRow1" class="h-row" data-type="trends"></div>
          <div id="trendRow2" class="h-row" data-type="trends"></div>
        </div>
      </section>

      <section class="section fade-up" aria-label="recomendados">
        <div class="head"><div class="title">Target Recomendados</div><div class="see-all" id="seeR">Ver todo</div></div>
        <div class="h-stack">
          <div id="recoRow1" class="h-row" data-type="reco"></div>
          <div id="recoRow2" class="h-row" data-type="reco"></div>
        </div>
      </section>

      <section class="section fade-up" aria-label="antes visto">
        <div class="head"><div class="title">Eye Antes visto</div><div class="see-all" id="seeV">Ver todo</div></div>
        <div class="h-stack">
          <div id="recentRow1" class="h-row" data-type="recent"></div>
          <div id="recentRow2" class="h-row" data-type="recent"></div>
        </div>
      </section>

      <section class="section fade-up" aria-label="explorar">
        <div class="head"><div class="title">Refresh Explorar — Aleatorio</div><div class="see-all" id="filterBtn">Filtrar</div></div>
        <div id="gridFeed" class="grid" aria-live="polite"></div>
      </section>
    </div>
  </main>

  <div id="fileSelectModal" role="dialog" aria-hidden="true">
    <div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
        <strong style="font-size:18px;">Subir a SinFiltro</strong>
        <button id="closeFileSelect" class="icon-btn">Close</button>
      </div>
      <input type="file" id="realFileInput" accept="image/*,video/*" style="width:100%;padding:10px;border:1px solid var(--muted);border-radius:8px;margin-bottom:10px;background:var(--card);color:var(--text);">
      <input type="text" id="uploadTitleInput" class="search-input" placeholder="Título (opcional)" style="width:100%;margin-bottom:15px;">
      <button id="startUploadBtn" class="icon-btn" style="width:100%;height:50px;background:linear-gradient(90deg,var(--accent-cyan),var(--accent-violet));color:var(--bg-1);font-weight:700;">Subir Ahora</button>
    </div>
  </div>

  <div id="radials" class="radials" aria-hidden="true"></div>
  <button id="fab" class="fab" aria-label="Crear">Plus</button>

  <nav class="bottom-nav" role="navigation">
    <div id="navHome" class="nav-item" data-tab="home">Home<div style="font-size:11px">Inicio</div></div>
    <div id="navSearch" class="nav-item" data-tab="search">Search<div style="font-size:11px">Buscar</div></div>
    <div style="width:78px"></div>
    <div id="navRecent" class="nav-item" data-tab="recent">Eye<div style="font-size:11px">Antes visto</div></div>
    <div id="navMe" class="nav-item" data-tab="me">User<div style="font-size:11px">Mi cuenta</div></div>
  </nav>

  <div id="viewer" class="viewer" role="dialog" aria-hidden="true">
    <div class="card" style="position:relative;padding:0;">
      <div id="viewerInner" style="padding:12px 12px 0 12px;"></div>
      <div id="viewerBottom" style="padding:12px;background:rgba(0,0,0,0.5);border-top:1px solid rgba(255,255,255,0.05);display:flex;flex-direction:column;gap:8px;position:relative;z-index:10;"></div>
      <div id="viewerControls" class="viewer-controls-meta">
        <button id="prevBtn" class="icon-btn" title="anterior">Left</button>
        <button id="vvPlay" class="play-ico" title="reproducir">Play</button>
        <button id="nextBtn" class="icon-btn" title="siguiente">Right</button>
        <button id="downloadBtn" class="icon-btn" title="Descargar">Download</button>
        <button id="closeViewer" class="icon-btn" title="cerrar">Close</button>
      </div>
    </div>
  </div>

  <div id="searchModal" class="modal" aria-hidden="true" role="dialog">
    <div class="head">
      <input id="searchInput" class="search-input" placeholder="Buscar (demo)..." />
      <button id="closeSearch" class="icon-btn">Close</button>
    </div>
    <div id="searchMini" class="grid-mini"></div>
  </div>

  <div id="myModal" class="modal" aria-hidden="true" role="dialog">
    <div class="head" style="justify-content:space-between">
      <strong>Mi cuenta (demo)</strong>
      <button id="closeMy" class="icon-btn">Close</button>
    </div>
    <div id="myGrid" class="grid-mini"></div>
  </div>

  <div id="uploadModal" aria-hidden="true" role="alertdialog">
    <h3 id="uploadTitle" style="margin-top:0;font-size:16px;">Subiendo archivo...</h3>
    <p id="uploadStatus" style="font-size:12px;color:var(--muted)">0%</p>
    <div class="progress-bar"><div id="progressFill" class="progress-fill"></div></div>
    <button id="closeUpload" class="icon-btn" style="margin-top:15px;background:transparent;border:1px solid var(--muted)">Cancelar</button>
  </div>

  <script>
    const SERVER_URL = window.location.origin;
    const $ = s => document.querySelector(s);
    const $$ = s => Array.from(document.querySelectorAll(s));
    const rand = n => Math.floor(Math.random() * n);
    const escapeHtml = s => String(s || '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));

    // === PEXELS API (GRATIS, SIN ANUNCIOS) ===
    const PEXELS_API_KEY = '563492ad6f917000010000018c7d8c7d8c7d8c7d8c7d8c7d8c7d'; // Clave pública de ejemplo
    async function fetchPexelsVideos() {
      try {
        const res = await fetch(`https://api.pexels.com/videos/popular?per_page=15`, {
          headers: { Authorization: PEXELS_API_KEY }
        });
        const data = await res.json();
        return data.videos.map(v => ({
          id: `pexels-${v.id}`,
          kind: 'video',
          src: v.video_files[0].link,
          thumbnail: v.image,
          title: `Video por ${v.user.name}`,
          likes: rand(900) + 100,
          comments: rand(200),
          views: (rand(50) + 10) + 'K',
          liked: false
        }));
      } catch (e) {
        console.warn('Pexels falló, usando mock', e);
        return [];
      }
    }

    // === MOCK FALLBACK + IMÁGENES ===
    const mockData = Array.from({length: 20}, (_, i) => ({
      id: `mock-${i}`,
      kind: i % 3 === 0 ? 'video' : 'image',
      src: i % 3 === 0 ? `https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4` : `https://picsum.photos/640/420?random=${i}`,
      thumbnail: `https://picsum.photos/640/420?random=${i}`,
      title: ['Calle nocturna', 'Atardecer', 'Retrato', 'Arte urbano', 'Gato', 'Perro', 'Ciudad', 'Naturaleza'][i % 8],
      likes: rand(800) + 100,
      comments: rand(150),
      views: (rand(9)+1)+'K',
      liked: false
    }));

    let pool = [], activeList = [], currentIndex = 0;
    const trendRow1 = $('#trendRow1'), trendRow2 = $('#trendRow2');
    const recoRow1 = $('#recoRow1'), recoRow2 = $('#recoRow2');
    const recentRow1 = $('#recentRow1'), recentRow2 = $('#recentRow2');
    const gridFeed = $('#gridFeed');
    const panel = $('#panel'), overlay = $('#overlay'), menuBtn = $('#menuBtn'), closePanelBtn = $('#closePanel');
    const viewer = $('#viewer'), viewerInner = $('#viewerInner'), closeViewer = $('#closeViewer'), prevBtn = $('#prevBtn'), nextBtn = $('#nextBtn'), vvPlay = $('#vvPlay'), downloadBtn = $('#downloadBtn');
    const viewerBottom = $('#viewerBottom');
    const fab = $('#fab'), radials = $('#radials');
    const themeToggle = $('#themeToggle');
    const brandBtn = $('#brandBtn');
    const searchTop = $('#searchTop');
    const searchModal = $('#searchModal'), searchMini = $('#searchMini'), searchInput = $('#searchInput'), closeSearch = $('#closeSearch');
    const myModal = $('#myModal'), myGrid = $('#myGrid'), closeMy = $('#closeMy');
    const uploadModal = $('#uploadModal'), progressFill = $('#progressFill'), uploadStatus = $('#uploadStatus'), uploadTitle = $('#uploadTitle'), closeUpload = $('#closeUpload');
    const fileSelectModal = $('#fileSelectModal'), closeFileSelect = $('#closeFileSelect'), realFileInput = $('#realFileInput'), uploadTitleInput = $('#uploadTitleInput'), startUploadBtn = $('#startUploadBtn');

    let imgObserver = null;
    function lazyObserve(root = document) {
      const media = root.querySelectorAll('img[data-src], video[data-src]');
      if ('IntersectionObserver' in window) {
        if (!imgObserver) {
          imgObserver = new IntersectionObserver((entries, obs) => {
            entries.forEach(e => {
              if (e.isIntersecting) {
                const el = e.target;
                el.src = el.dataset.src;
                el.onload = () => el.parentElement.classList.remove('skel');
                el.removeAttribute('data-src');
                obs.unobserve(el);
              }
            });
          }, { rootMargin: '300px', threshold: 0.05 });
        }
        media.forEach(m => imgObserver.observe(m));
      } else {
        media.forEach(m => { m.src = m.dataset.src; m.removeAttribute('data-src'); });
      }
    }

    function makeSmallCard(item) {
      const d = document.createElement('div');
      d.className = 'card-small skel fade-up';
      d.setAttribute('tabindex', '0');
      let mediaTag = '';
      if (item.kind === 'video') {
        mediaTag = `<video data-src="${item.src}" muted preload="metadata" style="position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:brightness(.56)"></video>`;
      } else {
        mediaTag = `<img data-src="${item.src}" alt="${escapeHtml(item.title)}">`;
      }
      d.innerHTML = `
        ${mediaTag}
        ${item.likes > 700 ? '<div class="mini-badge">HOT</div>' : ''}
        <div style="position:relative;z-index:6;width:100%;display:flex;justify-content:space-between;align-items:flex-end">
          <div class="meta">
            <div style="font-weight:700;font-size:13px">${escapeHtml(item.title)}</div>
            <div class="mini-stats">
              <span>Heart ${item.likes}</span>
              <span>Comment ${item.comments}</span>
              <span>Eye ${item.views}</span>
            </div>
          </div>
          <div>${item.kind === 'video' ? '<div class="play-ico">Play</div>' : ''}</div>
        </div>
      `;
      d.addEventListener('click', () => openViewerByItem(item));
      return d;
    }

    function makeGridCard(item) {
      const a = document.createElement('article');
      a.className = 'card skel fade-up';
      let mediaTag = item.kind === 'video' ? `<video data-src="${item.src}" muted preload="metadata" style="width:100%;height:150px;object-fit:cover"></video>` : `<img data-src="${item.src}" alt="${escapeHtml(item.title)}">`;
      a.innerHTML = `${mediaTag}<div class="body"><div class="title">${escapeHtml(item.title)}</div><div class="meta"><div>${item.views}</div><div>Heart ${item.likes} • Comment ${item.comments}</div></div></div>`;
      a.addEventListener('click', () => openViewerByItem(item));
      return a;
    }

    async function renderAll() {
      const pexels = await fetchPexelsVideos();
      pool = pexels.length > 0 ? pexels.concat(mockData) : mockData;
      renderTwoRows(trendRow1, trendRow2, pool.slice(0, 12));
      renderTwoRows(recoRow1, recoRow2, pool.slice(12, 24));
      renderTwoRows(recentRow1, recentRow2, pool.slice(24, 36));
      renderGridInitial(pool.slice(36));
      $$('.h-row').forEach(r => { enableDragScroll(r); r.addEventListener('scroll', handleHorizontalScroll); });
      lazyObserve();
    }

    function renderTwoRows(row1, row2, items) {
      row1.innerHTML = ''; row2.innerHTML = '';
      items.forEach((it, i) => (i % 2 === 0 ? row1 : row2).appendChild(makeSmallCard(it)));
    }

    function renderGridInitial(items) {
      gridFeed.innerHTML = '';
      items.forEach(it => gridFeed.appendChild(makeGridCard(it)));
      lazyObserve(gridFeed);
    }

    function enableDragScroll(el) {
      if (el.__dragEnabled) return;
      el.__dragEnabled = true;
      let startX = 0, scrollLeft = 0, isTouch = false;
      el.addEventListener('touchstart', e => { isTouch = true; startX = e.touches[0].pageX - el.offsetLeft; scrollLeft = el.scrollLeft; }, { passive: true });
      el.addEventListener('touchmove', e => { if (!isTouch) return; const x = e.touches[0].pageX - el.offsetLeft; el.scrollLeft = scrollLeft - (x - startX) * 1; }, { passive: true });
      el.addEventListener('pointerdown', e => { startX = e.pageX - el.offsetLeft; scrollLeft = el.scrollLeft; el.setPointerCapture(e.pointerId); }, { passive: true });
      el.addEventListener('pointermove', e => { if (!el.hasPointerCapture(e.pointerId)) return; const x = e.pageX - el.offsetLeft; el.scrollLeft = scrollLeft - (x - startX); }, { passive: true });
    }

    let horizontalLoading = false;
    function handleHorizontalScroll(e) {
      const row = e.target;
      if (row.scrollLeft + row.clientWidth >= row.scrollWidth - 100 && !horizontalLoading) {
        horizontalLoading = true;
        setTimeout(() => {
          for (let i = 0; i < 4; i++) row.appendChild(makeSmallCard(pool[rand(pool.length)]));
          lazyObserve(row);
          horizontalLoading = false;
        }, 300);
      }
    }

    function showViewer() {
      const it = activeList[currentIndex];
      if (!it) return;
      viewerInner.innerHTML = ''; viewerBottom.innerHTML = '';
      let media = it.kind === 'video' ? document.createElement('video') : document.createElement('img');
      media.src = it.src; media.controls = it.kind === 'video'; media.style.maxHeight = it.kind === 'video' ? '70vh' : '80vh';
      if (it.kind === 'image') media.alt = it.title;
      viewerInner.appendChild(media);

      viewerBottom.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div style="display:flex;gap:15px;font-size:14px;font-weight:600;">
            <span id="likeBtn" style="cursor:pointer;color:${it.liked ? 'var(--accent-violet)' : 'var(--muted)'};">Heart ${it.likes}</span>
            <span>Comment ${it.comments}</span>
          </div>
          <span style="font-size:12px;color:var(--muted);">Eye ${it.views} Vistas</span>
        </div>
        <div style="display:flex;gap:8px;align-items:center;">
          <input type="text" placeholder="Añade un comentario..." class="search-input" style="flex-grow:1;padding:10px;border-radius:8px;font-size:14px;background:rgba(255,255,255,0.1);">
          <button class="icon-btn" style="width:40px;height:40px;background:var(--accent-violet);color:#000;">Right</button>
        </div>
      `;

      $('#likeBtn').onclick = () => {
        it.liked = !it.liked;
        it.likes += it.liked ? 1 : -1;
        $('#likeBtn').style.color = it.liked ? 'var(--accent-violet)' : 'var(--muted)';
        $('#likeBtn').innerHTML = `Heart ${it.likes}`;
      };

      viewer.classList.add('show'); viewer.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
    }

    function openViewerByItem(item) {
      activeList = pool; currentIndex = pool.findIndex(x => x.id === item.id);
      if (currentIndex === -1) { activeList = [item]; currentIndex = 0; }
      showViewer();
    }

    function closeViewerFunc() { viewer.classList.remove('show'); viewer.setAttribute('aria-hidden', 'true'); viewerInner.innerHTML = ''; viewerBottom.innerHTML = ''; document.body.style.overflow = ''; }
    prevBtn.onclick = () => { if (currentIndex > 0) { currentIndex--; showViewer(); } };
    nextBtn.onclick = () => { if (currentIndex < activeList.length - 1) { currentIndex++; showViewer(); } else { activeList.push(pool[rand(pool.length)]); currentIndex++; showViewer(); } };
    closeViewer.onclick = closeViewerFunc;
    viewer.onclick = e => { if (e.target === viewer) closeViewerFunc(); };
    downloadBtn.onclick = () => {
      const item = activeList[currentIndex];
      const a = document.createElement('a');
      a.href = item.src; a.download = `SinFiltro_${item.id}.${item.kind === 'video' ? 'mp4' : 'jpg'}`;
      a.click();
    };

    // FAB
    fab.onclick = () => {
      if (radials.classList.contains('show')) { radials.classList.remove('show'); radials.innerHTML = ''; }
      else {
        radials.classList.add('show');
        const mk = (icon, text, action) => {
          const b = document.createElement('button'); b.className = 'bubble-group';
          b.innerHTML = `<span class="bubble">${icon}</span><span class="bubble-text">${text}</span>`;
          b.onclick = () => { radials.classList.remove('show'); action(); };
          return b;
        };
        radials.appendChild(mk('Upload', 'Subir Archivo', () => openFileSelectModal()));
        radials.appendChild(mk('Gallery', 'Publicar Galería', () => alert('Demo: Galería')));
        radials.appendChild(mk('Video', 'Crear Short', () => alert('Demo: Short')));
      }
    };

    // Upload
    function openFileSelectModal() { fileSelectModal.classList.add('show'); fileSelectModal.setAttribute('aria-hidden', 'false'); document.body.style.overflow = 'hidden'; }
    function closeFileSelectModal() { fileSelectModal.classList.remove('show'); fileSelectModal.setAttribute('aria-hidden', 'true'); realFileInput.value = ''; uploadTitleInput.value = ''; document.body.style.overflow = ''; }
    closeFileSelect.onclick = closeFileSelectModal;

    startUploadBtn.onclick = () => {
      const file = realFileInput.files[0];
      if (!file) return alert('Selecciona un archivo');
      const form = new FormData();
      form.append('file', file);
      form.append('title', uploadTitleInput.value || file.name);
      closeFileSelectModal();
      uploadModal.style.display = 'block'; uploadModal.setAttribute('aria-hidden', 'false');
      uploadTitle.textContent = 'Subiendo ' + file.name.substring(0, 15) + '...';
      progressFill.style.width = '0%'; uploadStatus.textContent = '0%';
      let p = 0; const sim = setInterval(() => { if (p < 90) { p += 5; progressFill.style.width = p + '%'; uploadStatus.textContent = p + '%'; } }, 200);

      fetch(`${SERVER_URL}/api/content/upload`, { method: 'POST', body: form })
        .then(r => r.json())
        .then(res => {
          clearInterval(sim); progressFill.style.width = '100%'; uploadStatus.textContent = '100%';
          setTimeout(() => {
            closeUploadModal();
            if (res.success) {
              pool.unshift({ ...res.item, liked: false, comments: 0, views: '0K' });
              renderAll();
              alert('¡Subido con éxito!');
            } else throw new Error(res.message);
          }, 800);
        })
        .catch(err => {
          clearInterval(sim); uploadTitle.textContent = 'Error'; uploadStatus.textContent = err.message;
          setTimeout(closeUploadModal, 3000);
        });
    };

    function closeUploadModal() { uploadModal.style.display = 'none'; uploadModal.setAttribute('aria-hidden', 'true'); }
    closeUpload.onclick = closeUploadModal;

    // Theme
    const THEME_KEY = 'sinfiltro.theme.v3';
    let theme = localStorage.getItem(THEME_KEY) || 'dark';
    function applyTheme(t) { if (t === 'light') { document.body.classList.add('light'); themeToggle.textContent = 'Sun'; } else { document.body.classList.remove('light'); themeToggle.textContent = 'Moon'; } }
    applyTheme(theme);
    themeToggle.onclick = () => { theme = theme === 'dark' ? 'light' : 'dark'; localStorage.setItem(THEME_KEY, theme); applyTheme(theme); };

    // Navigation
    brandBtn.onclick = () => window.scrollTo({top:0,behavior:'smooth'});
    $('#navHome').onclick = () => window.scrollTo({top:0,behavior:'smooth'});
    $('#navSearch').onclick = () => { populateSearchMini(); searchModal.classList.add('show'); searchModal.setAttribute('aria-hidden','false'); document.body.style.overflow = 'hidden'; };
    $('#navRecent').onclick = () => document.querySelector('[aria-label="antes visto"]')?.scrollIntoView({behavior:'smooth'});
    $('#navMe').onclick = () => { myGrid.innerHTML = ''; for(let i=0;i<9;i++){ const it=pool[rand(pool.length)]; const d=document.createElement('div'); d.className='mini-thumb'; d.innerHTML = it.kind==='video' ? `<video src="${it.src}" muted preload="metadata"></video>` : `<img src="${it.src}" alt="${escapeHtml(it.title)}">`; d.onclick=()=>{openViewerByItem(it);closeMyModal();}; myGrid.appendChild(d); } myModal.classList.add('show'); myModal.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; };
    function closeMyModal(){ myModal.classList.remove('show'); myModal.setAttribute('aria-hidden','true'); myGrid.innerHTML=''; document.body.style.overflow=''; } closeMy.onclick=closeMyModal; myModal.onclick=e=>{if(e.target===myModal)closeMyModal();};

    // Panel
    menuBtn.onclick = () => panel.classList.contains('open') ? closePanel() : openPanel();
    function openPanel(){ overlay.classList.add('show'); panel.classList.add('open'); panel.setAttribute('aria-hidden','false'); overlay.setAttribute('aria-hidden','false'); }
    function closePanel(){ overlay.classList.remove('show'); panel.classList.remove('open'); panel.setAttribute('aria-hidden','true'); overlay.setAttribute('aria-hidden','true'); }
    closePanelBtn.onclick = closePanel; overlay.onclick = e => { if(e.target===overlay){ closePanel(); if(radials.classList.contains('show')){radials.classList.remove('show');radials.innerHTML='';} if(fileSelectModal.classList.contains('show')) closeFileSelectModal(); } };
    $$('.panel-item').forEach(b=>b.onclick=()=>{closePanel(); const a=b.dataset.action; if(a==='home')window.scrollTo({top:0,behavior:'smooth'}); if(a==='trends')document.querySelector('[aria-label="tendencias"]')?.scrollIntoView({behavior:'smooth'}); if(a==='reco')document.querySelector('[aria-label="recomendados"]')?.scrollIntoView({behavior:'smooth'}); if(a==='my')$('#navMe').click();});

    // Infinite grid
    window.addEventListener('scroll', () => {
      if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 420) {
        for (let i = 0; i < 6; i++) gridFeed.appendChild(makeGridCard(pool[rand(pool.length)]));
        lazyObserve(gridFeed);
      }
    });

    function populateSearchMini() {
      searchMini.innerHTML = '';
      for (let i = 0; i < 12; i++) {
        const it = pool[rand(pool.length)];
        const d = document.createElement('div'); d.className = 'mini-thumb';
        d.innerHTML = it.kind === 'video' ? `<video src="${it.src}" muted preload="metadata"></video>` : `<img src="${it.src}" alt="${escapeHtml(it.title)}">`;
        d.onclick = () => { openViewerByItem(it); searchModal.classList.remove('show'); };
        searchMini.appendChild(d);
      }
    }

    searchTop.onclick = () => { populateSearchMini(); searchModal.classList.add('show'); searchModal.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; };
    closeSearch.onclick = () => { searchModal.classList.remove('show'); searchModal.setAttribute('aria-hidden','true'); searchMini.innerHTML=''; document.body.style.overflow=''; };
    searchModal.onclick = e => { if(e.target===searchModal) closeSearch.click(); };

    document.addEventListener('keydown', e => { if(e.key==='Escape'){ closeViewerFunc(); closePanel(); closeSearch.click(); closeMyModal(); closeUploadModal(); closeFileSelectModal(); } });
    document.addEventListener('DOMContentLoaded', renderAll);
  </script>
</body>
</html>
