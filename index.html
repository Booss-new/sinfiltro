<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SinFiltro ‚Äî Premium</title>
  <style>
    /* ====== Estilos base (id√©nticos al dise√±o aprobado) ====== */
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:"Poppins",sans-serif;
      background:linear-gradient(180deg,#0d0d0d,#111827);
      color:#eaf7ff;
      -webkit-font-smoothing:antialiased;
      overflow-y:auto;
      -webkit-overflow-scrolling:touch;
    }
    header{
      position:fixed;top:0;left:0;right:0;height:76px;
      display:flex;align-items:center;justify-content:space-between;
      padding:14px 16px;z-index:1000;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.005));
      backdrop-filter:blur(8px);
      border-bottom:1px solid rgba(255,255,255,0.02);
    }
    .header-left{display:flex;align-items:center;gap:12px}
    .icon-btn{width:46px;height:46px;border-radius:12px;background:rgba(255,255,255,0.02);display:inline-flex;align-items:center;justify-content:center;color:#9fb0bf;border:1px solid rgba(255,255,255,0.02);cursor:pointer}
    .logo{font-weight:700;font-size:20px;background:linear-gradient(90deg,#00d1ff,#8a6eff);-webkit-background-clip:text;background-clip:text;color:transparent}
    main{padding-top:96px;padding-bottom:120px;max-width:980px;margin:0 auto}
    .container{padding:12px}

    .hero{padding:16px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));border:1px solid rgba(255,255,255,0.02);box-shadow:0 10px 30px rgba(0,0,0,0.5)}
    .hero h1{color:#8a6eff;margin-bottom:6px;font-size:18px}
    .hero p{color:#9fb0bf;font-size:13px}

    .section{margin-top:18px}
    .section .head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .section .title{font-weight:800;color:#00d1ff;font-size:18px}
    .see-all{color:#9fb0bf;font-size:13px;cursor:pointer}

    /* horizontal rows */
    .h-row{display:flex;gap:12px;overflow-x:auto;padding-bottom:8px;scroll-snap-type:x mandatory;-webkit-overflow-scrolling:touch;touch-action:pan-y}
    .h-row::-webkit-scrollbar{display:none}
    .card{flex:0 0 190px;height:120px;border-radius:12px;overflow:hidden;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));border:1px solid rgba(255,255,255,0.02);position:relative;cursor:pointer;scroll-snap-align:center}
    .card img{width:100%;height:100%;object-fit:cover;display:block;filter:brightness(.6)}
    .card .meta{position:absolute;left:12px;bottom:10px;color:#fff;z-index:5}
    .badge{position:absolute;left:12px;top:12px;padding:6px 8px;border-radius:999px;background:linear-gradient(90deg,#00d1ff,#8a6eff);color:#001;font-weight:700;font-size:12px;z-index:6}

    /* grid */
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:12px}
    .grid .card{height:150px}
    .grid .body{padding:8px;color:#eaf7ff}
    .grid .title{font-weight:700}
    .grid .meta{font-size:12px;color:#9fb0bf;margin-top:6px;display:flex;justify-content:space-between;align-items:center}

    /* Streets canvas section */
    .streets-wrap{margin-top:18px;padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));border:1px solid rgba(255,255,255,0.02)}
    .streets-title{font-weight:800;color:#00d1ff;margin-bottom:8px}
    #streetsCanvas{width:100%;height:300px;border-radius:10px;background:linear-gradient(180deg,#071226,#091a2a);display:block}

    /* fab & bottom nav placeholders (kept for design) */
    .fab{position:fixed;left:50%;transform:translateX(-50%);bottom:68px;width:72px;height:72px;border-radius:50%;background:linear-gradient(135deg,#00d1ff,#8a6eff);display:flex;align-items:center;justify-content:center;color:#001;font-size:30px;z-index:190;border:none;box-shadow:0 30px 80px rgba(0,0,0,0.6)}
    .bottom-nav{position:fixed;left:12px;right:12px;bottom:10px;height:72px;border-radius:14px;background:linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.35));display:flex;align-items:center;justify-content:space-around;padding:0 8px;border:1px solid rgba(255,255,255,0.03);z-index:185}
    .nav-item{display:flex;flex-direction:column;align-items:center;gap:6px;color:#9fb0bf;font-size:12px;cursor:pointer}

    /* small screens */
    @media (max-width:420px){
      .card{flex:0 0 150px;height:100px}
      #streetsCanvas{height:260px}
    }
  </style>
</head>
<body>
  <header>
    <div class="header-left">
      <button id="menuBtn" class="icon-btn" aria-label="menu">‚ò∞</button>
      <button id="brandBtn" class="logo" style="background:linear-gradient(90deg,#00d1ff,#8a6eff);-webkit-background-clip:text;color:transparent">SinFiltro</button>
    </div>
    <div style="display:flex;align-items:center;gap:10px">
      <button id="searchTop" class="icon-btn" title="buscar">üîç</button>
      <button id="themeBtn" class="icon-btn" title="modo">üåó</button>
    </div>
  </header>

  <main>
    <div class="container">
      <section class="hero" aria-label="presentaci√≥n">
        <h1>Descubre lo aut√©ntico</h1>
        <p>Fotos y videos creados por la comunidad. Da like, comenta y comparte.</p>
      </section>

      <section class="section" aria-label="tendencias">
        <div class="head"><div class="title">üî• Tendencias</div><div class="see-all">Ver todo</div></div>
        <div id="row1" class="h-row"></div>
      </section>

      <section class="section" aria-label="recomendados">
        <div class="head"><div class="title">üéØ Recomendados</div><div class="see-all">Ver todo</div></div>
        <div id="row2" class="h-row"></div>
      </section>

      <section class="section" aria-label="antes-visto">
        <div class="head"><div class="title">‚èÆ Antes visto</div><div class="see-all">Ver todo</div></div>
        <div id="row3" class="h-row"></div>
      </section>

      <!-- Grid -->
      <section class="section" aria-label="explorar">
        <div class="head"><div class="title">üîÅ Explorar ‚Äî Aleatorio</div><div class="see-all">Filtrar</div></div>
        <div id="grid" class="grid"></div>
      </section>

      <!-- Streets (mapa simple top-down): Puras calles por ahora -->
      <section class="section streets-wrap" aria-label="calles">
        <div class="streets-title">üõ£Ô∏è Calles (mapa)</div>
        <canvas id="streetsCanvas" aria-label="mapa de calles"></canvas>
        <p style="color:#9fb0bf;font-size:13px;margin-top:8px">Mapa provisional: calles definidas (top-down). Esto es temporal: s√≥lo calles, sin edificios m√≥viles.</p>
      </section>
    </div>
  </main>

  <button class="fab" id="fab">Ôºã</button>

  <nav class="bottom-nav" role="navigation">
    <div class="nav-item" id="navHome">üè†<div style="font-size:11px">Inicio</div></div>
    <div class="nav-item" id="navSearch">üîç<div style="font-size:11px">Buscar</div></div>
    <div class="nav-item" id="navSeen">üëÅÔ∏è<div style="font-size:11px">Antes visto</div></div>
    <div class="nav-item" id="navMe">üë§<div style="font-size:11px">Tus videos</div></div>
  </nav>

  <script>
    /* =========================
       Versi√≥n base aprobada + secci√≥n "calles"
       - Mantengo comportamiento original: filas horizontales drag, lazy-load, grid, infinite vertical
       - A√±ad√≠ canvas "streetsCanvas" con calles definidas (top-down)
       - No cambio dise√±o ni estructura visual aprobada
       ========================= */

    /* ---- Refs ---- */
    const row1 = document.getElementById('row1');
    const row2 = document.getElementById('row2');
    const row3 = document.getElementById('row3');
    const grid = document.getElementById('grid');
    const themeBtn = document.getElementById('themeBtn');
    const body = document.body;

    /* ---- Demo data pool ---- */
    const pool = Array.from({length:40}).map((_,i)=>({
      id: 'i'+i,
      src: `https://picsum.photos/seed/${Math.floor(Math.random()*100000+i)}/640/360`,
      title: ['Callej√≥n','Atardecer','Retrato','Nocturna','Visual'][i%5],
      likes: Math.floor(Math.random()*6000),
      comments: Math.floor(Math.random()*1200),
      views: Math.floor(Math.random()*900)+'K',
      kind: (i%5===0)?'video':'image'
    }));

    /* ---- Lazy loading via IntersectionObserver ---- */
    let imgObserver = null;
    function lazyObserve(root=document){
      const imgs = root.querySelectorAll('img[data-src]');
      if('IntersectionObserver' in window){
        if(!imgObserver){
          imgObserver = new IntersectionObserver((entries,obs)=>{
            entries.forEach(e=>{
              if(e.isIntersecting){
                const img = e.target;
                img.src = img.dataset.src;
                img.onload = ()=> img.parentElement.classList.remove('skel');
                img.removeAttribute('data-src');
                obs.unobserve(img);
              }
            });
          }, {rootMargin:'300px', threshold:0.05});
        }
        imgs.forEach(i=> imgObserver.observe(i));
      } else {
        imgs.forEach(i=> { i.src = i.dataset.src; i.removeAttribute('data-src'); });
      }
    }

    /* ---- Create card elements ---- */
    function makeCard(item){
      const d = document.createElement('div');
      d.className = 'card skel';
      d.tabIndex = 0;
      d.innerHTML = `
        <img data-src="${item.src}" alt="${item.title}">
        ${item.likes>2000?'<div class="badge">TOP</div>':''}
        <div class="meta">
          <div style="font-weight:700">${item.kind==='video'?'Video':'Foto'}</div>
          <div style="font-size:12px;color:#fff;opacity:.95">‚ù§ ${item.likes} ‚Ä¢ üí¨ ${item.comments} ‚Ä¢ üëÅ ${item.views}</div>
        </div>
      `;
      d.addEventListener('click', ()=> openViewer(item));
      return d;
    }

    function makeGridCard(item){
      const a = document.createElement('article');
      a.className = 'card skel';
      a.innerHTML = `<img data-src="${item.src}" alt="${item.title}"><div class="body"><div class="title">${item.title}</div><div class="meta"><div>${item.views}</div><div>‚ù§ ${item.likes} ‚Ä¢ üí¨ ${item.comments}</div></div></div>`;
      a.addEventListener('click', ()=> openViewer(item));
      return a;
    }

    /* ---- Render rows and grid ---- */
    function fillRows(){
      row1.innerHTML = ''; row2.innerHTML = ''; row3.innerHTML = ''; grid.innerHTML = '';
      // distribute items
      for(let i=0;i<12;i++){
        row1.appendChild(makeCard(pool[i%pool.length]));
      }
      for(let i=12;i<24;i++){
        row2.appendChild(makeCard(pool[i%pool.length]));
      }
      for(let i=24;i<32;i++){
        row3.appendChild(makeCard(pool[i%pool.length]));
      }
      // grid
      for(let i=32;i<pool.length;i++){
        grid.appendChild(makeGridCard(pool[i]));
      }
      // ensure horizontal drag enabled
      enableDrag(row1); enableDrag(row2); enableDrag(row3);
      lazyObserve();
    }

    /* ---- Drag-to-scroll for horizontals (robust) ---- */
    function enableDrag(el){
      if(el.__drag) return;
      el.__drag = true;
      let isDown=false, startX, scrollLeft;
      el.addEventListener('touchstart', e=>{
        isDown = true;
        startX = e.touches[0].pageX - el.offsetLeft;
        scrollLeft = el.scrollLeft;
      }, {passive:true});
      el.addEventListener('touchmove', e=>{
        if(!isDown) return;
        const x = e.touches[0].pageX - el.offsetLeft;
        const walk = (x - startX) * 1;
        el.scrollLeft = scrollLeft - walk;
      }, {passive:true});
      el.addEventListener('touchend', ()=> { isDown=false; }, {passive:true});

      // pointer events for desktop / mouse
      let mouseDown=false;
      el.addEventListener('pointerdown', e=>{ mouseDown=true; startX = e.pageX - el.offsetLeft; scrollLeft = el.scrollLeft; el.setPointerCapture && el.setPointerCapture(e.pointerId); }, {passive:true});
      el.addEventListener('pointermove', e=>{ if(!mouseDown) return; const x = e.pageX - el.offsetLeft; const walk = (x - startX); el.scrollLeft = scrollLeft - walk; }, {passive:true});
      el.addEventListener('pointerup', e=>{ mouseDown=false; try{ e.target.releasePointerCapture && e.target.releasePointerCapture(e.pointerId);}catch(e){} }, {passive:true});
    }

    /* ---- Viewer (simple) ---- */
    const viewer = document.createElement('div');
    viewer.style.position='fixed'; viewer.style.inset='0'; viewer.style.display='none'; viewer.style.background='rgba(0,0,0,0.9)'; viewer.style.zIndex=1200; viewer.style.alignItems='center'; viewer.style.justifyContent='center';
    viewer.addEventListener('click', (e)=>{ if(e.target===viewer) hideViewer(); });
    document.body.appendChild(viewer);

    function openViewer(item){
      viewer.innerHTML = '';
      const c = document.createElement(item.kind==='video' ? 'video' : 'img');
      c.style.maxWidth='96%'; c.style.maxHeight='86%';
      if(item.kind==='video'){ c.src = item.src; c.controls = true; c.autoplay = true; }
      else { c.src = item.src; }
      viewer.appendChild(c);
      viewer.style.display='flex';
    }
    function hideViewer(){ viewer.style.display='none'; viewer.innerHTML=''; }

    /* ---- Infinite vertical load (grid) ---- */
    let loading = false;
    window.addEventListener('scroll', ()=>{
      if(window.innerHeight + window.scrollY >= document.body.offsetHeight - 420 && !loading){
        loading = true;
        setTimeout(()=>{
          for(let i=0;i<6;i++){
            grid.appendChild(makeGridCard(pool[Math.floor(Math.random()*pool.length)]));
          }
          lazyObserve(grid);
          loading = false;
        }, 700);
      }
    });

    /* ---- Theme toggle ---- */
    const THEME_KEY = 'sinfiltro.theme.v1';
    let theme = localStorage.getItem(THEME_KEY) || 'dark';
    function applyTheme(t){
      if(t==='light'){ body.classList.add('light'); themeBtn.textContent='‚òÄÔ∏è'; body.style.background = 'linear-gradient(180deg,#f5f9ff,#eef6ff)'; body.style.color='#071226'; }
      else { body.classList.remove('light'); themeBtn.textContent='üåó'; body.style.background = 'linear-gradient(180deg,#0d0d0d,#111827)'; body.style.color='#eaf7ff'; }
    }
    applyTheme(theme);
    themeBtn.addEventListener('click', ()=>{ theme = theme==='dark'?'light':'dark'; localStorage.setItem(THEME_KEY,theme); applyTheme(theme); });

    /* ---- Brand and nav (demo behaviors) ---- */
    document.getElementById('brandBtn').addEventListener('click', ()=> window.scrollTo({top:0,behavior:'smooth'}));
    document.getElementById('navHome').addEventListener('click', ()=> window.scrollTo({top:0,behavior:'smooth'}));
    document.getElementById('navSearch').addEventListener('click', ()=> alert('Demo: buscar'));
    document.getElementById('navSeen').addEventListener('click', ()=> document.querySelector('[aria-label="antes-visto"]').scrollIntoView({behavior:'smooth'}));
    document.getElementById('navMe').addEventListener('click', ()=> alert('Demo: tus videos'));

    /* ---- Render initial content ---- */
    document.addEventListener('DOMContentLoaded', ()=>{
      fillRows();
      lazyObserve();
      // ensure there are enough items in horizontals
      [row1,row2,row3].forEach(r=>{ while(r.children.length < 6){ r.appendChild(makeCard(pool[Math.floor(Math.random()*pool.length)]) ); }});
    });

    /* ========== Secci√≥n "Calles" (canvas simple con calles definidas) ========== */
    const canvas = document.getElementById('streetsCanvas');
    const ctx = canvas.getContext('2d');

    function resizeCanvas(){
      const rect = canvas.getBoundingClientRect();
      canvas.width = Math.floor(rect.width * (window.devicePixelRatio || 1));
      canvas.height = Math.floor(rect.height * (window.devicePixelRatio || 1));
      canvas.style.width = rect.width + 'px';
      canvas.style.height = rect.height + 'px';
      ctx.setTransform(window.devicePixelRatio || 1, 0, 0, window.devicePixelRatio || 1, 0, 0);
      drawStreets();
    }
    window.addEventListener('resize', resizeCanvas);
    // Example street layout: defined "streets" as straight horizontal/vertical lines forming blocks
    const streetsDefinition = {
      // grid of streets: spacing in pixels relative to canvas virtual coords
      spacing: 80,
      blocksX: 6,
      blocksY: 4,
      mainStreets: [1,3,5] // indices of main thicker streets horizontally/vertically
    };

    function drawStreets(){
      // clear
      ctx.clearRect(0,0,canvas.width,canvas.height);
      // background
      ctx.fillStyle = '#061018';
      ctx.fillRect(0,0,canvas.width,canvas.height);

      // compute a virtual grid with margins
      const margin = 18 * (window.devicePixelRatio || 1);
      const w = canvas.width - margin*2;
      const h = canvas.height - margin*2;
      const cols = streetsDefinition.blocksX;
      const rows = streetsDefinition.blocksY;
      const cellW = w / cols;
      const cellH = h / rows;

      // draw streets between blocks (simple representation)
      // vertical streets
      for(let i=0;i<=cols;i++){
        const x = margin + i * cellW;
        ctx.beginPath();
        ctx.moveTo(x, margin);
        ctx.lineTo(x, margin + h);
        ctx.lineWidth = (streetsDefinition.mainStreets.includes(i) ? 6 : 3);
        ctx.strokeStyle = (streetsDefinition.mainStreets.includes(i) ? '#17212a' : '#0f161a');
        ctx.stroke();
        // dashed center line for main streets
        if(streetsDefinition.mainStreets.includes(i)){
          ctx.setLineDash([8,10]);
          ctx.lineWidth = 1.2;
          ctx.strokeStyle = '#22343f';
          ctx.beginPath(); ctx.moveTo(x+6, margin); ctx.lineTo(x+6, margin + h); ctx.stroke();
          ctx.setLineDash([]);
        }
      }
      // horizontal streets
      for(let j=0;j<=rows;j++){
        const y = margin + j * cellH;
        ctx.beginPath();
        ctx.moveTo(margin, y);
        ctx.lineTo(margin + w, y);
        ctx.lineWidth = (streetsDefinition.mainStreets.includes(j) ? 6 : 3);
        ctx.strokeStyle = (streetsDefinition.mainStreets.includes(j) ? '#17212a' : '#0f161a');
        ctx.stroke();
        if(streetsDefinition.mainStreets.includes(j)){
          ctx.setLineDash([8,10]);
          ctx.lineWidth = 1.2;
          ctx.strokeStyle = '#22343f';
          ctx.beginPath(); ctx.moveTo(margin, y+6); ctx.lineTo(margin + w, y+6); ctx.stroke();
          ctx.setLineDash([]);
        }
      }

      // optionally draw small street posts at intersections
      ctx.fillStyle = '#2b3b44';
      for(let i=0;i<=cols;i++){
        for(let j=0;j<=rows;j++){
          const x = margin + i*cellW;
          const y = margin + j*cellH;
          ctx.beginPath();
          ctx.arc(x, y, 4, 0, Math.PI*2);
          ctx.fill();
        }
      }

      // label: "Calles definidas"
      ctx.fillStyle = '#9fb0bf';
      ctx.font = `${12 * (window.devicePixelRatio||1)}px Inter, Arial`;
      ctx.fillText('Calles definidas ‚Äî Vista top-down (provisional)', margin + 6, margin + 14);
    }

    // initialize canvas after DOM loaded
    window.addEventListener('load', ()=>{ resizeCanvas(); });

    /* Accessibility and keyboard: close viewer with Esc */
    window.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') hideViewer(); });

    /* NOTE: Este archivo mantiene la est√©tica aprobada y la estructura original.
       La secci√≥n "calles" es deliberadamente simple (solo v√≠as definidas).
       Cuando confirmes que la base es correcta, integro m√°s opciones (p. ej. permitir seleccionar una calle, resaltar, exportar coordenadas, o integrar esto con la parte de "juego" que quieras retomar). */
  </script>
</body>
</html>
